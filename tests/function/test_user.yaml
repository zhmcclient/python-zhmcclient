# Function tests for zhmcclient.User.
#
# This test file covers only the methods and properties that are defined in
# zhmcclient.User, but not any of the methods and properties inherited from
# zhmcclient.BaseResource.

setup:
  resources:
    - uri: /api/console
      name: Console1
      parent_uri: null
      parent_attribute: consoles
      properties:
        description: Console 1
    - uri: /api/users/user1
      name: User1
      parent_uri: /api/console
      parent_attribute: users
      properties:
        description: User 1

testcases:

  - name: test_user_delete_success
    description: Test User.delete() with success
    setup:
      testfile_setup: true
    zhmcclient_call:
      target:
        _resource:
          uri: /api/users/user1
      method: delete
    zhmcclient_result:
      return: null
    hmc_interactions:
      - http_request:
          method: DELETE
          uri: /api/users/user1
        http_response:
          status: 204

  - name: test_user_delete_error_busy
    description: Test User.delete() with error 409,1 (busy)
    setup:
      testfile_setup: true
    zhmcclient_call:
      target:
        _resource:
          uri: /api/users/user1
      method: delete
      # Note: User.delete() does not support busy_retries
    zhmcclient_result:
      exception:
        class: HTTPError
        attributes:
          http_status: 409
          reason: 1
          request_method: DELETE
          request_uri: /api/users/user1
          request_body: {}
          message: 'Busy, try later'
    hmc_interactions:
      - http_request:
          method: DELETE
          uri: /api/users/user1
        http_response:
          status: 409
          body:
            request-method: DELETE
            request-uri: /api/users/user1
            request-body: {}
            http-status: 409
            reason: 1
            message: 'Busy, try later'

  - name: test_user_update_properties_success
    description: Test User.update_properties() with success
    setup:
      testfile_setup: true
    zhmcclient_call:
      target:
        _resource:
          uri: /api/users/user1
      method: update_properties
      parameters:
        properties:
          description: foo
    zhmcclient_result:
      return: null
    hmc_interactions:
      - http_request:
          method: POST
          uri: /api/users/user1
          body:
            description: foo
        http_response:
          status: 204

  - name: test_user_add_user_role_success
    description: Test User.add_user_role() with success
    setup:
      testfile_setup: true
      resources:
        - uri: /api/user-roles/role1
          name: Role1
          parent_uri: /api/console
          parent_attribute: user_roles
          properties:
            description: Role 1
    zhmcclient_call:
      target:
        _resource:
          uri: /api/users/user1
      method: add_user_role
      parameters:
        user_role:
          _resource:
            uri: /api/user-roles/role1
    zhmcclient_result:
      return: null
    hmc_interactions:
      - http_request:
          method: POST
          uri: /api/users/user1/operations/add-user-role
          body:
            user-role-uri: /api/user-roles/role1
        http_response:
          status: 204

  - name: test_user_remove_user_role_success
    description: Test User.remove_user_role() with success
    setup:
      testfile_setup: true
      resources:
        - uri: /api/user-roles/role1
          name: Role1
          parent_uri: /api/console
          parent_attribute: user_roles
          properties:
            description: Role 1
    zhmcclient_call:
      target:
        _resource:
          uri: /api/users/user1
      method: remove_user_role
      parameters:
        user_role:
          _resource:
            uri: /api/user-roles/role1
    zhmcclient_result:
      return: null
    hmc_interactions:
      - http_request:
          method: POST
          uri: /api/users/user1/operations/remove-user-role
          body:
            user-role-uri: /api/user-roles/role1
        http_response:
          status: 204
